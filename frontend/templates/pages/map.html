{% extends 'base.html' %}
{% load static %}

{% block title %}ë¶„ì‹¤ë¬¼ ë“±ë¡ (ì§€ë„ í¬í•¨) - MeetAgain{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">ğŸ—ºï¸ ì§€ë„ì—ì„œ ìœ„ì¹˜ ì„ íƒ</h2>

  <!-- ì§€ë„ -->
  <div id="map" style="width: 100%; height: 350px; margin-bottom: 20px; background: #eee;"></div>

  <!-- í¼ -->
  <form method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.non_field_errors }}

    <div class="mb-3">
      <label for="id_location" class="form-label">ì¥ì†Œ</label>
      {{ form.location|add_class:"form-control" }}
    </div>

    <div class="mb-3">
      <label for="id_image" class="form-label">ì‚¬ì§„</label>
      {{ form.image|add_class:"form-control" }}
    </div>

    <!-- ê¸°íƒ€ í•„ë“œë„ í•„ìš”í•˜ë©´ ì¶”ê°€ ê°€ëŠ¥ -->
    <button type="submit" class="btn btn-primary">ë“±ë¡</button>
  </form>
</div>
{% endblock %}

{% block script %}
<!-- Kakao Map SDK -->
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_API_KEY&libraries=services"></script>
<script>
  const container = document.getElementById('map');
  const options = {
    center: new kakao.maps.LatLng(37.5922, 127.0165),  // ì´ˆê¸° ì¤‘ì‹¬ ì¢Œí‘œ
    level: 3
  };
  const map = new kakao.maps.Map(container, options);
  const geocoder = new kakao.maps.services.Geocoder();
  const marker = new kakao.maps.Marker({ map: map });

  // ì§€ë„ í´ë¦­ ì‹œ ì£¼ì†Œ ê²€ìƒ‰ â†’ input ì±„ìš°ê¸°
  kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
    const latlng = mouseEvent.latLng;
    geocoder.coord2Address(latlng.getLng(), latlng.getLat(), function(result, status) {
      if (status === kakao.maps.services.Status.OK) {
        const address = result[0].address.address_name;
        document.getElementById('id_location').value = address;
        marker.setPosition(latlng);
      }
    });
  });
</script>
{% endblock %}
