<!-- ì•Œë¦¼ ì‚¬ì´ë“œë°” -->
<div id="alertSidebar"
     data-open="0"
     style="
       position: fixed; top: 0; right: -400px; width: 400px; height: 100vh;
       background: #fff; box-shadow: -2px 0 5px rgba(0,0,0,.2);
       padding: 20px; z-index: 1060; transition: right .3s ease-in-out;
     "
     aria-hidden="true" role="complementary">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="mb-0">ğŸ”” ì•Œë¦¼</h5>
    <button class="btn btn-sm btn-outline-secondary" type="button" onclick="toggleSidebar()">ë‹«ê¸°</button>
  </div>

  <p class="text-muted">í‚¤ì›Œë“œë¥¼ ë“±ë¡í•˜ê³  ì•Œë¦¼ì„ ë°›ì•„ë³´ì„¸ìš”.</p>
  <button class="btn btn-danger btn-sm mb-3" type="button" onclick="toggleKeywordInput()">í‚¤ì›Œë“œ ë“±ë¡í•˜ê¸°</button>

  <div id="keywordInputGroup" style="display:none;">
    <input type="text" id="keywordInput" class="form-control mb-2" placeholder="ì˜ˆ: ì•„ì´íŒ¨ë“œ, í…€ë¸”ëŸ¬">
    <button class="btn btn-outline-secondary btn-sm mb-2" type="button" onclick="addKeyword()">ì¶”ê°€</button>
  </div>

  <div id="keywordList" class="mb-3"></div>
  <hr>
  <div id="alertList" style="max-height: 300px; overflow-y:auto;">
    {% if notifications %}
      <ul>
        {% for n in notifications %}
          <li>
            [{{ n.created_at|date:"Y-m-d H:i" }}] í‚¤ì›Œë“œ '{{ n.keyword }}' ê´€ë ¨ ì•Œë¦¼
            {% if n.is_read %}(ì½ìŒ){% else %}(ì½ì§€ ì•ŠìŒ){% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>ë°›ì€ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endif %}
  </div>
</div>

<script>
  // ì„œë²„ì—ì„œ í‚¤ì›Œë“œ ëª©ë¡ ë°›ì•„ì„œ ë¿Œë¦¬ê¸°
  function loadKeywords() {
    fetch('/keywords/')
      .then(res => res.json())
      .then(data => {
        const keywordList = document.getElementById('keywordList');
        keywordList.innerHTML = '';
        if (!data.keywords || data.keywords.length === 0) {
          keywordList.innerHTML = '<p>ë“±ë¡ëœ í‚¤ì›Œë“œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
          return;
        }
        const ul = document.createElement('ul');
        data.keywords.forEach(word => {
          const li = document.createElement('li');
          li.textContent = word;
          ul.appendChild(li);
        });
        keywordList.appendChild(ul);
      })
      .catch(console.error);
  }

  // ì„œë²„ì—ì„œ ì•Œë¦¼ ëª©ë¡ ë°›ì•„ì„œ ë¿Œë¦¬ê¸°
  function loadNotifications() {
    fetch('/notifications/')
      .then(res => res.json())
      .then(data => {
        const alertList = document.getElementById('alertList');
        alertList.innerHTML = '';
        if (!data.notifications || data.notifications.length === 0) {
          alertList.innerHTML = '<p>ë°›ì€ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
          return;
        }
        const ul = document.createElement('ul');
        data.notifications.forEach(n => {
          const li = document.createElement('li');
          li.textContent = `[${n.created_at}] í‚¤ì›Œë“œ '${n.keyword}' ê´€ë ¨ ì•Œë¦¼ ${n.is_read ? '(ì½ìŒ)' : '(ì½ì§€ ì•ŠìŒ)'}`;
          ul.appendChild(li);
        });
        alertList.appendChild(ul);
      })
      .catch(console.error);
  }

  // ì‚¬ì´ë“œë°”ê°€ ì—´ë¦´ ë•Œ í‚¤ì›Œë“œì™€ ì•Œë¦¼ ëª©ë¡ ê°™ì´ ë¶ˆëŸ¬ì˜¤ê¸°
  const originalToggleSidebar = window.toggleSidebar;
  window.toggleSidebar = function() {
    originalToggleSidebar();
    const sidebar = document.getElementById('alertSidebar');
    if (sidebar && sidebar.dataset.open === '1') {  // ì—´ë¦° ìƒíƒœì¼ ë•Œë§Œ ë¡œë“œ
      loadKeywords();
      loadNotifications();
    }
  }
</script>
