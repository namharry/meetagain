{% extends 'base/base.html' %}
{% block title %}MeetAgain - ë¶„ì‹¤ë¬¼ ì¡°íšŒ{% endblock %}

{% block content %}
<div class="container-fluid mt-4 position-relative">
  <h4 class="text-center mb-4 fw-bold" style="font-size: 24px;">MeetAgain</h4>

  <div class="row">
    <div class="col-md-7">
      <div class="border p-4 bg-light mb-4">
        <h5>ğŸ” ë¶„ì‹¤ë¬¼ ì¡°íšŒ</h5>
        <div class="row g-2">
          <div class="col-md-6">
            <label class="form-label">ì¢…ë¥˜</label>
            <select id="typeSelect" class="form-select" onchange="updateSubOptions()">
              <option selected disabled>ì¢…ë¥˜ ì„ íƒ</option>
              <option>ê°€ë°©</option>
              <option>ê·€ê¸ˆì†</option>
              <option>ì˜ë¥˜</option>
              <option>ì „ìê¸°ê¸°</option>
              <option>ì§€ê°‘</option>
              <option>ì»´í“¨í„°</option>
              <option>ì¹´ë“œ</option>
              <option>í˜„ê¸ˆ</option>
              <option>íœ´ëŒ€í°</option>
              <option>ê¸°íƒ€</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">ì„¸ë¶€ì˜µì…˜</label>
            <select id="subOptionSelect" class="form-select">
              <option selected disabled>ì„¸ë¶€ì˜µì…˜ ì„ íƒ</option>
            </select>
          </div>
          <div class="col-md-12">
            <label class="form-label">ë¶„ì‹¤ë¬¼ëª…</label>
            <input type="text" class="form-control" placeholder="ì˜ˆ: íŒŒë€ìƒ‰ ìš°ì‚°">
          </div>
          <div class="col-md-12">
            <label class="form-label">ë¶„ì‹¤ ê¸°ê°„</label>
            <div class="d-flex gap-2">
              <input type="date" class="form-control">
              <span class="align-self-center">~</span>
              <input type="date" class="form-control">
            </div>
          </div>
          <div class="col-md-12">
            <label class="form-label">ë¶„ì‹¤ ì¥ì†Œ</label>
            <select class="form-select">
              <option selected disabled>ì¥ì†Œ ì„ íƒ</option>
              <option>ë‚œí–¥ê´€</option>
              <option>ì„±ì‹ ê´€</option>
              <option>ìˆ˜ì •ê´€</option>
              <option>ì¤‘ì•™ë„ì„œê´€</option>
              <option>ì¡°í˜•1ê´€</option>
              <option>ì¡°í˜•2ê´€</option>
              <option>ì²´ìœ¡ê´€</option>
              <option>í”„ë¼ì„ê´€</option>
              <option>í–‰ì •ê´€</option>
              <option>í•™ìƒíšŒê´€</option>
              <option>ìŒì•…ê´€</option>
              <option>ê¸°íƒ€</option>
            </select>
          </div>
          <div class="col-12 text-end mt-3">
            <a class="btn btn-primary" href="{% url 'meetagain:index' %}#items">ê²€ìƒ‰</a>
          </div>
        </div>
      </div>

      <h5 class="mb-3">ğŸ“‹ ë“±ë¡ëœ ë¶„ì‹¤ë¬¼ ë¦¬ìŠ¤íŠ¸</h5>
      <div class="row row-cols-1 row-cols-md-3 g-4 mb-4" id="items">
        {% for item in items %}
        <div class="col">
          <div class="card lost-card">
            {% if item.image %}
            <img src="{{ item.image.url }}" alt="{{ item.name }}">
            {% else %}
            <img src="https://via.placeholder.com/300x160" alt="ì´ë¯¸ì§€ ì—†ìŒ">
            {% endif %}
            <div class="card-body">
              <p class="text-center fw-bold">{{ item.name }}</p>
              <p class="text-center text-muted small">{{ item.lost_date|date:"Y-m-d" }}</p>
              <p class="text-center text-muted small">{{ item.lost_location }}</p>
            </div>
          </div>
        </div>
        {% empty %}
        <p>ë“±ë¡ëœ ë¶„ì‹¤ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endfor %}
      </div>
    </div>

    <div class="col-md-5">
      <div id="map" style="width:100%; height:380px; border-radius:12px; box-shadow: 0 4px 12px rgba(0,0,0,.06);"></div>
      <div class="d-flex gap-2 mt-3">
        <!-- ì¢Œ: ìŠµë“ë¬¼ ë“±ë¡ â†’ meetagain:found_register -->
        <a href="{% url 'meetagain:found_register' %}" class="btn btn-found px-5 py-5 w-50 flex-fill">
          ğŸ“¥ ë¬¼ê±´ì„ ì£¼ì› ì–´ìš”!<br><small>(ìŠµë“ë¬¼ ë“±ë¡)</small>
        </a>
        <!-- ìš°: ë¶„ì‹¤ ì‹ ê³  â†’ meetagain:lost_register -->
        <a href="{% url 'meetagain:lost_register' %}" class="btn btn-lost px-5 py-5 w-50 flex-fill">
          ğŸ“¤ ë¬¼ê±´ì„ ìƒì–´ë²„ë ¸ì–´ìš”..<br><small>(ë¶„ì‹¤ë¬¼ ì‹ ê³ )</small>
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  const subOptions = {
    "ê·€ê¸ˆì†": ["ë°˜ì§€", "ëª©ê±¸ì´", "ê·€ê±¸ì´", "ì‹œê³„", "ê¸°íƒ€"],
    "ì˜ë¥˜": ["ëª¨ì", "ì‹ ë°œ", "ì•„ìš°í„°", "ê¸°íƒ€ì˜ë¥˜"],
    "ì „ìê¸°ê¸°": ["íƒœë¸”ë¦¿", "ìŠ¤ë§ˆíŠ¸ì›Œì¹˜", "ë¬´ì„ ì´ì–´í°", "ì¹´ë©”ë¼", "í—¤ë“œì…‹", "ê¸°íƒ€ìš©í’ˆ"]
  };
  function updateSubOptions() {
    const type = document.getElementById("typeSelect").value;
    const subSelect = document.getElementById("subOptionSelect");
    subSelect.innerHTML = '<option disabled selected>ì„¸ë¶€ì˜µì…˜ ì„ íƒ</option>';
    if (subOptions[type]) {
      subOptions[type].forEach(opt => {
        const o = document.createElement("option");
        o.value = o.text = opt;
        subSelect.appendChild(o);
      });
    } else {
      const o = document.createElement("option");
      o.text = "í•´ë‹¹ ì—†ìŒ";
      subSelect.appendChild(o);
    }
  }

  // Kakao Map
  window.addEventListener('load', function () {
    const container = document.getElementById('map');
    if (!container || !window.kakao || !kakao.maps) return;
    const map = new kakao.maps.Map(container, {
      center: new kakao.maps.LatLng(37.591360, 127.021961),
      level: 1
    });
    new kakao.maps.Marker({
      map,
      position: new kakao.maps.LatLng(37.59136, 127.021961),
      title: 'MeetAgain'
    });
  });
</script>
{% endblock %}