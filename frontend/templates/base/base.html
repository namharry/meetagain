{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}MeetAgain{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap, FontAwesome, Custom CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link href="{% static 'css/style.css' %}" rel="stylesheet">

  <!-- Kakao Map -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=f387153e7e5f423d38f1a6d392d6bef8&libraries=services"></script>

  <style>
    .btn-found {
      background-color: #ebf0ff; /* 아주 연한 연파랑+흰색 */
      color: #000000; /* 검정 텍스트 */
      border: none;
    }
    .btn-found:hover {
      background-color: #d4dbff; /* 호버 시 약간 진해짐 */
      color: #000000;
    }

    .btn-lost {
      background-color: #f5ebff; /* 아주 연한 연보라+흰색 */
      color: #000000; /* 검정 텍스트 */
      border: none;
    }
    .btn-lost:hover {
      background-color: #ddc4ff; /* 호버 시 약간 진해짐 */
      color: #000000;
    }
  </style>

  {% block extra_head %}{% endblock %}
  {% block extra_css %}{% endblock %}
</head>
<body>

<div class="container-fluid mt-4 position-relative">

  {% if request.path != '/users/login/' and request.path != '/users/signup/' and request.path != '/users/password_reset/' %}
  <div id="topIcons" class="top-icons d-flex justify-content-end gap-3" style="position: fixed; top: 20px; right: 20px; font-size: 20px; z-index: 1100;">
    <i class="fa-solid fa-bell" onclick="toggleSidebar()" style="cursor:pointer;"></i>
    <i class="fa-solid fa-bars" onclick="toggleMenuSidebar()" style="cursor:pointer;"></i>
  </div>
  {% endif %}

  {% include "pages/menu_sidebar.html" %}
  {% include "pages/alert_sidebar.html" %}

  {% if messages %}
    <div class="container mt-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  {% block content %}{% endblock %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>

<script>
  // 알림 사이드바 토글 (오른쪽)
  window.toggleSidebar = function () {
    const el = document.getElementById('alertSidebar');
    const icons = document.getElementById('topIcons');
    if (!el || !icons) return;

    const isOpen = el.dataset.open === '1';
    const newOpenState = isOpen ? '0' : '1';
    el.style.right = newOpenState === '1' ? '0' : '-400px';
    el.dataset.open = newOpenState;

    icons.style.setProperty('display', newOpenState === '1' ? 'none' : 'flex', 'important');

    if (newOpenState === '1') {  // 사이드바 열릴 때만 실행
      console.log("사이드바 열림 감지, 키워드와 알림 목록 로드 시작");
      loadKeywords();
      loadNotifications();
    }
  };

  // 메뉴 사이드바 토글 (오른쪽)
  window.toggleMenuSidebar = function () {
    const el = document.getElementById('menuSidebar');
    const icons = document.getElementById('topIcons');
    if (!el || !icons) return;

    const isOpen = el.dataset.open === '1';
    const newOpenState = isOpen ? '0' : '1';
    el.style.right = newOpenState === '1' ? '0' : '-300px';
    el.dataset.open = newOpenState;

    icons.style.setProperty('display', newOpenState === '1' ? 'none' : 'flex', 'important');
  };

  // 알림 사이드바 내 키워드 입력 토글
  window.toggleKeywordInput = function () {
    const g = document.getElementById('keywordInputGroup');
    if (!g) return;
    g.style.display = (g.style.display === 'none' || !g.style.display) ? 'block' : 'none';
  };

  // 알림 사이드바 키워드 추가(pill 형태)
window.addKeyword = function () {
  const input = document.getElementById('keywordInput');
  const list = document.getElementById('keywordList');
  if (!input || !list) return;

  const text = (input.value || '').trim();
  if (!text) return;

  // 키워드 pill 역할을 하는 span 생성
  const pill = document.createElement('span');
  pill.className = 'badge rounded-pill text-bg-light me-1 mb-1';  // pill 스타일
  pill.textContent = text;

  // ×(삭제) 버튼 생성
  const removeBtn = document.createElement('button');
  removeBtn.type = 'button';
  removeBtn.className = 'btn btn-sm btn-link text-danger ms-1 p-0';
  removeBtn.textContent = '×';
  removeBtn.onclick = () => pill.remove();  // 클릭 시 pill 삭제

  // pill 안에 삭제 버튼 추가
  pill.appendChild(removeBtn);

  // 키워드 리스트에 pill 추가
  list.appendChild(pill);

  // 입력창 초기화
  input.value = '';
};

</script>

{% block extra_scripts %}{% endblock %}
{% block script %}{% endblock %}
</body>
</html>
